{"version":3,"sources":["/tools/packaging/package-map.js"],"names":["isIsobuildFeaturePackage","module","watch","require","v","_","packageVersionParser","utils","exports","PackageMap","versions","options","self","_map","_localCatalog","localCatalog","each","version","packageName","packageSource","getPackageSource","kind","extend","prototype","eachPackage","iterator","info","infoClone","clone","getInfo","has","makeSubsetMap","packageNames","subsetVersions","Error","toJSON","ret","sourceRoot","toVersionMap","isSupersetOfJSON","mapJSON","all","jsonInfo","thisInfo","fromReleaseVersion","releaseVersion","toolPackageVersion","tool","parsePackageAndVersion","toolPackage","package","toolVersion","versionMap","packages","PackageMapDelta","_changedPackages","packageMap","oldVersion","cachedVersions","_storeAddOrChange","anticipatedPrereleases","neededToUseUnanticipatedPrereleases","_storeRemove","newInfo","backwardsIncompatible","majorVersion","isPrerelease","test","isAnticipatedPrerelease","newVersion","isBackwardsIncompatible","isUnanticipatedPrerelease","eachChangedPackage","hasChanges","isEmpty","displayOnConsole","title","displayItems","anyBackwardsIncompatible","anyUnanticipatedPrerelease","push","name","description","lessThan","Console","printPackageList"],"mappings":"AAAA,IAAIA,wBAAJ;AAA6BC,OAAOC,KAAP,CAAaC,QAAQ,yBAAR,CAAb,EAAgD;AAACH,2BAAyBI,CAAzB,EAA2B;AAACJ,+BAAyBI,CAAzB;AAA2B;;AAAxD,CAAhD,EAA0G,CAA1G;;AAA7B,IAAIC,IAAIF,QAAQ,YAAR,CAAR;;AACA,IAAIG,uBAAuBH,QAAQ,6BAAR,CAA3B;;AACA,IAAII,QAAQJ,QAAQ,mBAAR,CAAZ;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAK,QAAQC,UAAR,GAAqB,UAAUC,QAAV,EAAoBC,OAApB,EAA6B;AAChD,MAAIC,OAAO,IAAX;AACAD,YAAUA,WAAW,EAArB;AACAC,OAAKC,IAAL,GAAY,EAAZ;AACAD,OAAKE,aAAL,GAAqBH,QAAQI,YAAR,IAAwB,IAA7C;;AAEAV,IAAEW,IAAF,CAAON,QAAP,EAAiB,UAAUO,OAAV,EAAmBC,WAAnB,EAAgC;AAC/C;AACA;AACA,QAAIlB,yBAAyBkB,WAAzB,CAAJ,EAA2C;AACzC;AACD;;AAED,QAAIC,gBAAgBP,KAAKE,aAAL,IACdF,KAAKE,aAAL,CAAmBM,gBAAnB,CAAoCF,WAApC,CADN;;AAEA,QAAIC,aAAJ,EAAmB;AACjBP,WAAKC,IAAL,CAAUK,WAAV,IACE;AAAEG,cAAM,OAAR;AAAiBJ,iBAASA,OAA1B;AAAmCE,uBAAeA;AAAlD,OADF;AAED,KAHD,MAGO;AACLP,WAAKC,IAAL,CAAUK,WAAV,IACE;AAAEG,cAAM,WAAR;AAAqBJ,iBAASA,OAA9B;AAAuCE,uBAAe;AAAtD,OADF;AAED;AACF,GAhBD;AAiBD,CAvBD;;AAyBAd,EAAEiB,MAAF,CAASd,QAAQC,UAAR,CAAmBc,SAA5B,EAAuC;AACrCC,eAAa,UAAUC,QAAV,EAAoB;AAC/B,QAAIb,OAAO,IAAX;;AACAP,MAAEW,IAAF,CAAOJ,KAAKC,IAAZ,EAAkB,UAAUa,IAAV,EAAgBR,WAAhB,EAA6B;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,UAAIS,YAAYtB,EAAEuB,KAAF,CAAQF,IAAR,CAAhB;;AACAD,eAASP,WAAT,EAAsBS,SAAtB;AACD,KATD;AAUD,GAboC;AAcrCE,WAAS,UAAUX,WAAV,EAAuB;AAC9B,QAAIN,OAAO,IAAX;;AACA,QAAIP,EAAEyB,GAAF,CAAMlB,KAAKC,IAAX,EAAiBK,WAAjB,CAAJ,EAAmC;AACjC,aAAON,KAAKC,IAAL,CAAUK,WAAV,CAAP;AACD;;AACD,WAAO,IAAP;AACD,GApBoC;AAqBrCa,iBAAe,UAAUC,YAAV,EAAwB;AACrC,QAAIpB,OAAO,IAAX;AACA,QAAIqB,iBAAiB,EAArB;;AACA5B,MAAEW,IAAF,CAAOgB,YAAP,EAAqB,UAAUd,WAAV,EAAuB;AAC1C,UAAIQ,OAAOd,KAAKiB,OAAL,CAAaX,WAAb,CAAX;;AACA,UAAI,CAACQ,IAAL,EAAW;AACT,cAAMQ,MAAM,mBAAmBhB,WAAzB,CAAN;AACD;;AACDe,qBAAef,WAAf,IAA8BQ,KAAKT,OAAnC;AACD,KAND;;AAOA,WAAO,IAAIT,QAAQC,UAAZ,CAAuBwB,cAAvB,EAAuC;AAC5ClB,oBAAcH,KAAKE;AADyB,KAAvC,CAAP;AAGD,GAlCoC;AAoCrCqB,UAAQ,YAAY;AAClB,QAAIvB,OAAO,IAAX;AACA,QAAIwB,MAAM,EAAV;;AACA/B,MAAEW,IAAF,CAAOJ,KAAKC,IAAZ,EAAkB,UAAUa,IAAV,EAAgBR,WAAhB,EAA6B;AAC7C,UAAIQ,KAAKL,IAAL,KAAc,OAAlB,EAA2B;AACzBe,YAAIlB,WAAJ,IAAmB;AACjBG,gBAAM,OADW;AAEjBgB,sBAAYX,KAAKP,aAAL,CAAmBkB;AAFd,SAAnB;AAID,OALD,MAKO;AACLD,YAAIlB,WAAJ,IAAmB;AACjBG,gBAAM,WADW;AAEjBJ,mBAASS,KAAKT;AAFG,SAAnB;AAID;AACF,KAZD;;AAaA,WAAOmB,GAAP;AACD,GArDoC;AAsDrC;AACA;AACAE,gBAAc,YAAY;AACxB,QAAI1B,OAAO,IAAX;AACA,QAAIwB,MAAM,EAAV;;AACA/B,MAAEW,IAAF,CAAOJ,KAAKC,IAAZ,EAAkB,UAAUa,IAAV,EAAgBR,WAAhB,EAA6B;AAC7CkB,UAAIlB,WAAJ,IAAmBQ,KAAKT,OAAxB;AACD,KAFD;;AAGA,WAAOmB,GAAP;AACD,GA/DoC;AAiErC;AACA;AACAG,oBAAkB,UAAUC,OAAV,EAAmB;AACnC,QAAI5B,OAAO,IAAX;AACA,WAAOP,EAAEoC,GAAF,CAAMD,OAAN,EAAe,UAAUE,QAAV,EAAoBxB,WAApB,EAAiC;AACrD,UAAIyB,WAAW/B,KAAKiB,OAAL,CAAaX,WAAb,CAAf;;AACA,UAAI,CAAEyB,QAAN,EAAgB;AACd,eAAO,KAAP;AACD;;AACD,UAAID,SAASrB,IAAT,KAAkBsB,SAAStB,IAA/B,EAAqC;AACnC,eAAO,KAAP;AACD;;AACD,UAAIsB,SAAStB,IAAT,KAAkB,OAAtB,EAA+B;AAC7B,eAAOsB,SAASxB,aAAT,CAAuBkB,UAAvB,KAAsCK,SAASL,UAAtD;AACD,OAFD,MAEO;AACL,eAAOM,SAAS1B,OAAT,KAAqByB,SAASzB,OAArC;AACD;AACF,KAbM,CAAP;AAcD;AAnFoC,CAAvC,E,CAsFA;AACA;AACA;AACA;AACA;AACA;;;AACAT,QAAQC,UAAR,CAAmBmC,kBAAnB,GAAwC,UAAUC,cAAV,EAA0B;AAChE,MAAIC,qBAAqBD,eAAeE,IAAf,IACnBxC,MAAMyC,sBAAN,CAA6BH,eAAeE,IAA5C,CADN;;AAEA,MAAI,CAACD,kBAAL,EAAyB;AACvB,UAAM,IAAIZ,KAAJ,CAAU,0BAA0BW,eAAeE,IAAnD,CAAN;AACD;;AACD,MAAIE,cAAcH,mBAAmBI,OAArC;AACA,MAAIC,cAAcL,mBAAmB7B,OAArC;;AAEA,MAAImC,aAAa/C,EAAEuB,KAAF,CAAQiB,eAAeQ,QAAf,IAA2B,EAAnC,CAAjB;;AACAD,aAAWH,WAAX,IAA0BE,WAA1B,CAVgE,CAYhE;AACA;;AACA,SAAO,IAAI3C,QAAQC,UAAZ,CAAuB2C,UAAvB,CAAP;AACD,CAfD,C,CAmBA;AACA;;;AACA5C,QAAQ8C,eAAR,GAA0B,UAAU3C,OAAV,EAAmB;AAC3C,MAAIC,OAAO,IAAX;AACAA,OAAK2C,gBAAL,GAAwB,EAAxB;AAEA5C,UAAQ6C,UAAR,CAAmBhC,WAAnB,CAA+B,UAAUN,WAAV,EAAuBQ,IAAvB,EAA6B;AAC1D,QAAI+B,aAAapD,EAAEyB,GAAF,CAAMnB,QAAQ+C,cAAd,EAA8BxC,WAA9B,IACTP,QAAQ+C,cAAR,CAAuBxC,WAAvB,CADS,GAC6B,IAD9C;;AAEAN,SAAK+C,iBAAL,CACEzC,WADF,EACeQ,IADf,EACqB+B,UADrB,EACiC9C,QAAQiD,sBADzC,EAEEjD,QAAQkD,mCAFV;AAGD,GAND;;AAQAxD,IAAEW,IAAF,CAAOL,QAAQ+C,cAAf,EAA+B,UAAUD,UAAV,EAAsBvC,WAAtB,EAAmC;AAChE,QAAI,CAAEP,QAAQ6C,UAAR,CAAmB3B,OAAnB,CAA2BX,WAA3B,CAAN,EAA+C;AAC7CN,WAAKkD,YAAL,CAAkB5C,WAAlB,EAA+BuC,UAA/B;AACD;AACF,GAJD;AAKD,CAjBD;;AAmBApD,EAAEiB,MAAF,CAASd,QAAQ8C,eAAR,CAAwB/B,SAAjC,EAA4C;AAC1CoC,qBAAmB,UAAUzC,WAAV,EAAuB6C,OAAvB,EAAgCN,UAAhC,EACUG,sBADV,EAEUC,mCAFV,EAE+C;AAChE,QAAIjD,OAAO,IAAX,CADgE,CAGhE;;AACA,QAAImD,QAAQ9C,OAAR,KAAoBwC,UAAxB,EAAoC;AAClC;AACD;;AAED,QAAIO,wBACEP,eAAe,IAAf,IACCnD,qBAAqB2D,YAArB,CAAkCF,QAAQ9C,OAA1C,MACAX,qBAAqB2D,YAArB,CAAkCR,UAAlC,CAHP;AAKA,QAAIS,eAAe,IAAIC,IAAJ,CAASJ,QAAQ9C,OAAjB,CAAnB;;AACA,QAAImD,0BAA0B/D,EAAEyB,GAAF,CAAM8B,sBAAN,EAA8B1C,WAA9B,KACxBb,EAAEyB,GAAF,CAAM8B,uBAAuB1C,WAAvB,CAAN,EAA2C6C,QAAQ9C,OAAnD,CADN;;AAEAL,SAAK2C,gBAAL,CAAsBrC,WAAtB,IAAqC;AACnCuC,kBAAYA,UADuB;AAEnCY,kBAAYN,QAAQ9C,OAFe;AAGnCqD,+BAAyBN,qBAHU;AAInCO,iCAA4BV,uCACAK,YADA,IACgB,CAACE;AALV,KAArC;AAOD,GA1ByC;AA4B1CN,gBAAc,UAAU5C,WAAV,EAAuBuC,UAAvB,EAAmC;AAC/C,QAAI7C,OAAO,IAAX;AACAA,SAAK2C,gBAAL,CAAsBrC,WAAtB,IAAqC;AACnCuC,kBAAYA,UADuB;AAEnCY,kBAAY;AAFuB,KAArC;AAID,GAlCyC;AAoC1CG,sBAAoB,UAAU/C,QAAV,EAAoB;AACtC,QAAIb,OAAO,IAAX;;AACAP,MAAEW,IAAF,CAAOJ,KAAK2C,gBAAZ,EAA8B,UAAU7B,IAAV,EAAgBR,WAAhB,EAA6B;AACzDO,eAASP,WAAT,EAAsBb,EAAEuB,KAAF,CAAQF,IAAR,CAAtB;AACD,KAFD;AAGD,GAzCyC;AA2C1C+C,cAAY,YAAY;AACtB,QAAI7D,OAAO,IAAX;AACA,WAAO,CAAEP,EAAEqE,OAAF,CAAU9D,KAAK2C,gBAAf,CAAT;AACD,GA9CyC;AAgD1CoB,oBAAkB,UAAUhE,OAAV,EAAmB;AACnC,QAAIC,OAAO,IAAX;AACAD,cAAUN,EAAEiB,MAAF,CAAS;AACjBsD,aAAO;AADU,KAAT,EAEPjE,OAFO,CAAV,CAFmC,CAMnC;;AACA,QAAI,CAAEC,KAAK6D,UAAL,EAAN,EAAyB;AACvB;AACD;;AAED,QAAII,eAAe,EAAnB;AACA,QAAIC,2BAA2B,KAA/B;AACA,QAAIC,6BAA6B,KAAjC;AACAnE,SAAK4D,kBAAL,CAAwB,UAAUtD,WAAV,EAAuBQ,IAAvB,EAA6B;AACnD,UAAIA,KAAK2C,UAAL,KAAoB,IAAxB,EAA8B;AAC5BQ,qBAAaG,IAAb,CAAkB;AAChBC,gBAAM/D,WADU;AAEhBgE,uBAAa;AAFG,SAAlB;AAIA;AACD;;AAED,UAAID,OAAO/D,WAAX;;AACA,UAAIQ,KAAK4C,uBAAT,EAAkC;AAChCW,gBAAQ,GAAR;AACAH,mCAA2B,IAA3B;AACD;;AACD,UAAIpD,KAAK6C,yBAAT,EAAoC;AAClCU,gBAAQ,GAAR;AACAF,qCAA6B,IAA7B;AACD;;AAED,UAAIG,WAAJ;;AACA,UAAIxD,KAAK+B,UAAL,KAAoB,IAAxB,EAA8B;AAC5ByB,sBAAc,oBAAoBxD,KAAK2C,UAAvC;AACD,OAFD,MAEO,IAAI/D,qBAAqB6E,QAArB,CAA8BzD,KAAK+B,UAAnC,EAC8B/B,KAAK2C,UADnC,CAAJ,EACoD;AACzDa,sBACE,mBAAmBxD,KAAK+B,UAAxB,GAAqC,MAArC,GAA8C/B,KAAK2C,UADrD;AAED,OAJM,MAIA;AACLa,sBACE,qBAAqBxD,KAAK+B,UAA1B,GAAuC,MAAvC,GAAgD/B,KAAK2C,UADvD;AAED;;AACDQ,mBAAaG,IAAb,CAAkB;AAAEC,cAAMA,IAAR;AAAcC,qBAAaA;AAA3B,OAAlB;AACD,KA/BD;;AAiCA,QAAIE,UAAUjF,QAAQ,uBAAR,EAAiCiF,OAA/C;;AAEAA,YAAQ1D,IAAR;AACA0D,YAAQ1D,IAAR,CAAaf,QAAQiE,KAArB;AACAQ,YAAQ1D,IAAR;AACAnB,UAAM8E,gBAAN,CAAuBR,YAAvB;;AACA,QAAIC,wBAAJ,EAA8B;AAC5BM,cAAQ1D,IAAR,CAAa,OACnB,6EADmB,GAEnB,eAFM;AAGD;;AACD,QAAIqD,0BAAJ,EAAgC;AAC9BK,cAAQ1D,IAAR,CAAa,OACnB,mFADmB,GAEnB,aAFM;AAGD;AACF;AA/GyC,CAA5C","file":"tools/packaging/package-map.js.map","sourcesContent":["var _ = require('underscore');\nvar packageVersionParser = require('./package-version-parser.js');\nvar utils = require('../utils/utils.js');\nimport { isIsobuildFeaturePackage } from '../isobuild/compiler.js';\n\n// PackageMap: Represents the choices of package versions being used for a\n// project. It knows all the packages that are used (direct and indirect\n// dependencies), their versions, whether they are local or versioned packages,\n// and the PackageSource object for any local packages.  Prefer using this\n// function over arbitrary JSON representations when possible.  (A related class\n// is projectContextModule.PackageMapFile which specifically represents the\n// .meteor/packages file on disk.)\n//\n// It has a corresponding JSON format (used, eg, inside buildinfo files).\n//\n// If you specify the localCatalog option to the constructor, any package in\n// that localCatalog will be considered to be local, and all others will be\n// considered to be prebuilt versioned packages from troposphere.  If you do not\n// specify the localCatalog option, all packages will be considered to prebuilt\n// versioned packages.\nexports.PackageMap = function (versions, options) {\n  var self = this;\n  options = options || {};\n  self._map = {};\n  self._localCatalog = options.localCatalog || null;\n\n  _.each(versions, function (version, packageName) {\n    // If the constraint solver told us that we needed an isobuild feature,\n    // that's fine, but it's not a real package.\n    if (isIsobuildFeaturePackage(packageName)) {\n      return;\n    }\n\n    var packageSource = self._localCatalog &&\n          self._localCatalog.getPackageSource(packageName);\n    if (packageSource) {\n      self._map[packageName] =\n        { kind: 'local', version: version, packageSource: packageSource };\n    } else {\n      self._map[packageName] =\n        { kind: 'versioned', version: version, packageSource: null };\n    }\n  });\n};\n\n_.extend(exports.PackageMap.prototype, {\n  eachPackage: function (iterator) {\n    var self = this;\n    _.each(self._map, function (info, packageName) {\n      // For reasons that are super unclear, if this `_.clone` is inlined into\n      // the `iterator` call, the value produced can mysteriously turn into\n      // undefined on the way into `iterator`. Presumably some sort of memory\n      // corruption, maybe Fiber-related?  Trying to minimize has been an\n      // exercise in nondeterminism. But this does seem to be a sure-fire way to\n      // fix it, for now. Who knows why, and who knows when it will recur again.\n      var infoClone = _.clone(info);\n      iterator(packageName, infoClone);\n    });\n  },\n  getInfo: function (packageName) {\n    var self = this;\n    if (_.has(self._map, packageName)) {\n      return self._map[packageName];\n    }\n    return null;\n  },\n  makeSubsetMap: function (packageNames) {\n    var self = this;\n    var subsetVersions = {};\n    _.each(packageNames, function (packageName) {\n      var info = self.getInfo(packageName);\n      if (!info) {\n        throw Error(\"not a subset: \" + packageName);\n      }\n      subsetVersions[packageName] = info.version;\n    });\n    return new exports.PackageMap(subsetVersions, {\n      localCatalog: self._localCatalog\n    });\n  },\n\n  toJSON: function () {\n    var self = this;\n    var ret = {};\n    _.each(self._map, function (info, packageName) {\n      if (info.kind === 'local') {\n        ret[packageName] = {\n          kind: 'local',\n          sourceRoot: info.packageSource.sourceRoot\n        };\n      } else {\n        ret[packageName] = {\n          kind: 'versioned',\n          version: info.version\n        };\n      }\n    });\n    return ret;\n  },\n  // Returns a map from package name to version. In most cases, this is a far\n  // worse representation than PackageMap... avoid using it!\n  toVersionMap: function () {\n    var self = this;\n    var ret = {};\n    _.each(self._map, function (info, packageName) {\n      ret[packageName] = info.version;\n    });\n    return ret;\n  },\n\n  // Given some JSON as returned from toJSON, returns true if every package in\n  // the JSON has the same mapping as in this map.\n  isSupersetOfJSON: function (mapJSON) {\n    var self = this;\n    return _.all(mapJSON, function (jsonInfo, packageName) {\n      var thisInfo = self.getInfo(packageName);\n      if (! thisInfo) {\n        return false;\n      }\n      if (jsonInfo.kind !== thisInfo.kind) {\n        return false;\n      }\n      if (thisInfo.kind === 'local') {\n        return thisInfo.packageSource.sourceRoot === jsonInfo.sourceRoot;\n      } else {\n        return thisInfo.version === jsonInfo.version;\n      }\n    });\n  }\n});\n\n// Static method: returns a PackageMap that represents a (catalog)\n// ReleaseVersion entry (including its tool).  Note that this function assumes\n// that all packages will be prebuilt versioned, not local. This is mostly used\n// to create PackageMaps to pass to tropohouse.downloadPackagesMissingFromMap;\n// it should not be used as part of a ProjectContext because it does not allow\n// you to override release packages with local packages.\nexports.PackageMap.fromReleaseVersion = function (releaseVersion) {\n  var toolPackageVersion = releaseVersion.tool &&\n        utils.parsePackageAndVersion(releaseVersion.tool);\n  if (!toolPackageVersion) {\n    throw new Error(\"bad tool in release: \" + releaseVersion.tool);\n  }\n  var toolPackage = toolPackageVersion.package;\n  var toolVersion = toolPackageVersion.version;\n\n  var versionMap = _.clone(releaseVersion.packages || {});\n  versionMap[toolPackage] = toolVersion;\n\n  // As described in this function's description, all packages in this map are\n  // versioned, so we do not specify a localCatalog.\n  return new exports.PackageMap(versionMap);\n};\n\n\n\n// PackageMapDelta: represents the change in a PackageMap between two constraint\n// solver runs.\nexports.PackageMapDelta = function (options) {\n  var self = this;\n  self._changedPackages = {};\n\n  options.packageMap.eachPackage(function (packageName, info) {\n    var oldVersion = _.has(options.cachedVersions, packageName)\n          ? options.cachedVersions[packageName] : null;\n    self._storeAddOrChange(\n      packageName, info, oldVersion, options.anticipatedPrereleases,\n      options.neededToUseUnanticipatedPrereleases);\n  });\n\n  _.each(options.cachedVersions, function (oldVersion, packageName) {\n    if (! options.packageMap.getInfo(packageName)) {\n      self._storeRemove(packageName, oldVersion);\n    }\n  });\n};\n\n_.extend(exports.PackageMapDelta.prototype, {\n  _storeAddOrChange: function (packageName, newInfo, oldVersion,\n                               anticipatedPrereleases,\n                               neededToUseUnanticipatedPrereleases) {\n    var self = this;\n\n    // Store nothing if nothing has changed.\n    if (newInfo.version === oldVersion) {\n      return;\n    }\n\n    var backwardsIncompatible =\n          oldVersion !== null &&\n          (packageVersionParser.majorVersion(newInfo.version) !==\n           packageVersionParser.majorVersion(oldVersion));\n\n    var isPrerelease = /-/.test(newInfo.version);\n    var isAnticipatedPrerelease = _.has(anticipatedPrereleases, packageName) &&\n          _.has(anticipatedPrereleases[packageName], newInfo.version);\n    self._changedPackages[packageName] = {\n      oldVersion: oldVersion,\n      newVersion: newInfo.version,\n      isBackwardsIncompatible: backwardsIncompatible,\n      isUnanticipatedPrerelease: (neededToUseUnanticipatedPrereleases &&\n                                  isPrerelease && !isAnticipatedPrerelease)\n    };\n  },\n\n  _storeRemove: function (packageName, oldVersion) {\n    var self = this;\n    self._changedPackages[packageName] = {\n      oldVersion: oldVersion,\n      newVersion: null\n    };\n  },\n\n  eachChangedPackage: function (iterator) {\n    var self = this;\n    _.each(self._changedPackages, function (info, packageName) {\n      iterator(packageName, _.clone(info));\n    });\n  },\n\n  hasChanges: function () {\n    var self = this;\n    return ! _.isEmpty(self._changedPackages);\n  },\n\n  displayOnConsole: function (options) {\n    var self = this;\n    options = _.extend({\n      title: \"Changes to your project's package version selections:\"\n    }, options);\n\n    // Print nothing at all if nothing changed.\n    if (! self.hasChanges()) {\n      return;\n    }\n\n    var displayItems = [];\n    var anyBackwardsIncompatible = false;\n    var anyUnanticipatedPrerelease = false;\n    self.eachChangedPackage(function (packageName, info) {\n      if (info.newVersion === null) {\n        displayItems.push({\n          name: packageName,\n          description: \"removed from your project\"\n        });\n        return;\n      }\n\n      var name = packageName;\n      if (info.isBackwardsIncompatible) {\n        name += '*';\n        anyBackwardsIncompatible = true;\n      }\n      if (info.isUnanticipatedPrerelease) {\n        name += '+';\n        anyUnanticipatedPrerelease = true;\n      }\n\n      var description;\n      if (info.oldVersion === null) {\n        description = \"added, version \" + info.newVersion;\n      } else if (packageVersionParser.lessThan(info.oldVersion,\n                                               info.newVersion)) {\n        description =\n          \"upgraded from \" + info.oldVersion + \" to \" + info.newVersion;\n      } else {\n        description =\n          \"downgraded from \" + info.oldVersion + \" to \" + info.newVersion;\n      }\n      displayItems.push({ name: name, description: description });\n    });\n\n    var Console = require('../console/console.js').Console;\n\n    Console.info();\n    Console.info(options.title);\n    Console.info();\n    utils.printPackageList(displayItems);\n    if (anyBackwardsIncompatible) {\n      Console.info(\"\\n\" +\n\"* These packages have been updated to new versions that are not backwards\\n\" +\n\"  compatible.\");\n    }\n    if (anyUnanticipatedPrerelease) {\n      Console.info(\"\\n\" +\n\"+ In order to resolve constraints, we had to use experimental versions of these\\n\" +\n\"  packages.\");\n    }\n  }\n});\n"]}